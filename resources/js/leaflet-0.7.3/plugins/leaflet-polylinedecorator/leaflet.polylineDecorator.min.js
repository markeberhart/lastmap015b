L.LineUtil.PolylineDecorator={computeAngle:function(a,b){return 180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI+90},getPointPathPixelLength:function(a){var b=a.length;if(2>b)return 0;for(var c=0,e=a[0],d=1;d<b;d++)c+=e.distanceTo(e=a[d]);return c},getPixelLength:function(a,b){var c=a instanceof L.Polyline?a.getLatLngs():a,e=c.length;if(2>e)return 0;for(var d=0,f=b.latLngToLayerPoint(c[0]),g=1;g<e;g++)d+=f.distanceTo(f=b.latLngToLayerPoint(c[g]));return d},projectPatternOnPath:function(a,b,c,e){var d=[],f;
f=0;for(l=a.length;f<l;f++)d[f]=e.latLngToLayerPoint(a[f]);a=this.projectPatternOnPointPath(d,b,c);f=0;for(l=a.length;f<l;f++)a[f].latLng=e.layerPointToLatLng(a[f].pt);return a},projectPatternOnPointPath:function(a,b,c){var e=[],d=this.getPointPathPixelLength(a)*c;b=this.interpolateOnPointPath(a,b);e.push(b);if(0<c){a=a.slice(b.predecessor);a[0]=b.pt;for(c=this.getPointPathPixelLength(a);d<=c;)b=this.interpolateOnPointPath(a,d/c),e.push(b),a=a.slice(b.predecessor),a[0]=b.pt,c=this.getPointPathPixelLength(a)}return e},
interpolateOnPointPath:function(a,b){var c=a.length;if(2>c)return null;if(0>=b)return{pt:a[0],predecessor:0,heading:this.computeAngle(a[0],a[1])};if(1<=b)return{pt:a[c-1],predecessor:c-1,heading:this.computeAngle(a[c-2],a[c-1])};if(2==c)return{pt:this.interpolateBetweenPoints(a[0],a[1],b),predecessor:0,heading:this.computeAngle(a[0],a[1])};for(var e=this.getPointPathPixelLength(a),d=a[0],f=d,g=0,h=0,k=0,j=1;j<c&&h<b;j++)d=f,g=h,f=a[j],k+=d.distanceTo(f),h=k/e;return{pt:this.interpolateBetweenPoints(d,
f,(b-g)/(h-g)),predecessor:j-2,heading:this.computeAngle(d,f)}},interpolateBetweenPoints:function(a,b,c){return b.x!=a.x?new L.Point(a.x*(1-c)+c*b.x,a.y*(1-c)+c*b.y):new L.Point(a.x,a.y+(b.y-a.y)*c)}};L.RotatedMarker=L.Marker.extend({options:{angle:0},_setPos:function(a){L.Marker.prototype._setPos.call(this,a);if(L.DomUtil.TRANSFORM)this._icon.style[L.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)";else if(L.Browser.ie){var b=this.options.angle*(Math.PI/180);a=Math.cos(b);b=Math.sin(b);this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+a+", M12="+-b+", M21="+b+", M22="+a+")"}}});
L.rotatedMarker=function(a,b){return new L.RotatedMarker(a,b)};L.Symbol=L.Symbol||{};
L.Symbol.Dash=L.Class.extend({isZoomDependant:!0,options:{pixelSize:10,pathOptions:{}},initialize:function(a){L.Util.setOptions(this,a);this.options.pathOptions.clickable=!1},buildSymbol:function(a,b,c){b=this.options;var e=Math.PI/180;if(1>=b.pixelSize)return new L.Polyline([a.latLng,a.latLng],b.pathOptions);var d=c.project(a.latLng);a=-(a.heading-90)*e;a=new L.Point(d.x+b.pixelSize*Math.cos(a+Math.PI)/2,d.y+b.pixelSize*Math.sin(a)/2);d=d.add(d.subtract(a));return new L.Polyline([c.unproject(a),c.unproject(d)],
b.pathOptions)}});L.Symbol.dash=function(a){return new L.Symbol.Dash(a)};
L.Symbol.ArrowHead=L.Class.extend({isZoomDependant:!0,options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(a){L.Util.setOptions(this,a);this.options.pathOptions.clickable=!1},buildSymbol:function(a,b,c){b=this.options;return b.polygon?new L.Polygon(this._buildArrowPath(a,c),b.pathOptions):new L.Polyline(this._buildArrowPath(a,c),b.pathOptions)},_buildArrowPath:function(a,b){var c=Math.PI/180,e=b.project(a.latLng),d=-(a.heading-90)*c,f=this.options.headAngle/
2*c,c=d+f,d=d-f,c=new L.Point(e.x-this.options.pixelSize*Math.cos(c),e.y+this.options.pixelSize*Math.sin(c)),e=new L.Point(e.x-this.options.pixelSize*Math.cos(d),e.y+this.options.pixelSize*Math.sin(d));return[b.unproject(c),a.latLng,b.unproject(e)]}});L.Symbol.arrowHead=function(a){return new L.Symbol.ArrowHead(a)};
L.Symbol.Marker=L.Class.extend({isZoomDependant:!1,options:{markerOptions:{},rotate:!1},initialize:function(a){L.Util.setOptions(this,a);this.options.markerOptions.clickable=!1;this.options.markerOptions.draggable=!1;this.isZoomDependant=L.Browser.ie&&this.options.rotate},buildSymbol:function(a){return this.options.rotate?(this.options.markerOptions.angle=a.heading,new L.RotatedMarker(a.latLng,this.options.markerOptions)):new L.Marker(a.latLng,this.options.markerOptions)}});L.Symbol.marker=function(a){return new L.Symbol.Marker(a)};L.PolylineDecorator=L.LayerGroup.extend({options:{patterns:[]},initialize:function(a,b){L.LayerGroup.prototype.initialize.call(this);L.Util.setOptions(this,b);this._map=null;this._initPaths(a);this._initPatterns()},_initPaths:function(a){this._paths=[];if(a instanceof L.Polyline)this._initPath(a.getLatLngs(),a instanceof L.Polygon);else if(L.Util.isArray(a)&&0<a.length)if(a[0]instanceof L.Polyline)for(var b=0;b<a.length;b++)this._initPath(a[b].getLatLngs(),a[b]instanceof L.Polygon);else this._initPath(a)},
_isCoordArray:function(a){return L.Util.isArray(a)&&0<a.length&&(a[0]instanceof L.LatLng||L.Util.isArray(a[0])&&2==a[0].length&&"number"===typeof a[0][0])},_initPath:function(a,b){var c;c=this._isCoordArray(a)?[a]:a;for(var e=0;e<c.length;e++)b&&c[e].push(c[e][0]),this._paths.push(c[e])},_initPatterns:function(){this._isZoomDependant=!1;this._patterns=[];for(var a,b=0;b<this.options.patterns.length;b++)a=this._parsePatternDef(this.options.patterns[b]),this._patterns.push(a),this._isZoomDependant=
this._isZoomDependant||a.isOffsetInPixels||a.isRepeatInPixels||a.symbolFactory.isZoomDependant},setPatterns:function(a){this.options.patterns=a;this._initPatterns();this._softRedraw()},setPaths:function(a){this._initPaths(a);this.redraw()},_parsePatternDef:function(a){var b={cache:[],symbolFactory:a.symbol,isOffsetInPixels:!1,isRepeatInPixels:!1};"string"===typeof a.offset&&-1!=a.offset.indexOf("%")?b.offset=parseFloat(a.offset)/100:(b.offset=parseFloat(a.offset),b.isOffsetInPixels=0<b.offset);"string"===
typeof a.repeat&&-1!=a.repeat.indexOf("%")?b.repeat=parseFloat(a.repeat)/100:(b.repeat=parseFloat(a.repeat),b.isRepeatInPixels=0<b.repeat);return b},onAdd:function(a){this._map=a;this._draw();if(this._isZoomDependant)this._map.on("zoomend",this._softRedraw,this)},onRemove:function(a){this._map.off("zoomend",this._softRedraw,this);this._map=null;L.LayerGroup.prototype.onRemove.call(this,a)},_buildSymbols:function(a,b,c){for(var e=[],d=0,f=c.length;d<f;d++)e.push(b.buildSymbol(c[d],a,this._map,d,f));
return e},_getCache:function(a,b,c){var e=a.cache[b];return"undefined"===typeof e?(a.cache[b]=[],null):e[c]},_getDirectionPoints:function(a,b){var c=this._map.getZoom(),e=this._getCache(b,c,a);if(e)return e;var d;d=null;var f=this._paths[a];b.isOffsetInPixels?(d=L.LineUtil.PolylineDecorator.getPixelLength(f,this._map),e=b.offset/d):e=b.offset;b.isRepeatInPixels?(d=null!==d?d:L.LineUtil.PolylineDecorator.getPixelLength(f,this._map),d=b.repeat/d):d=b.repeat;e=L.LineUtil.PolylineDecorator.projectPatternOnPath(f,
e,d,this._map);return b.cache[c][a]=e},redraw:function(){this._redraw(!0)},_softRedraw:function(){this._redraw(!1)},_redraw:function(a){if(null!==this._map){this.clearLayers();if(a)for(a=0;a<this._patterns.length;a++)this._patterns[a].cache=[];this._draw()}},_drawPattern:function(a){for(var b,c=0;c<this._paths.length;c++){b=this._getDirectionPoints(c,a);b=this._buildSymbols(this._paths[c],a.symbolFactory,b);for(var e=0;e<b.length;e++)this.addLayer(b[e])}},_draw:function(){for(var a=0;a<this._patterns.length;a++)this._drawPattern(this._patterns[a])}});
L.polylineDecorator=function(a,b){return new L.PolylineDecorator(a,b)};
